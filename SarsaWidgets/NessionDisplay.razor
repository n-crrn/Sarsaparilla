@*
* A component dedicated to displaying a nonce session.
*@
@using SarsaWidgets.Primitives
@using StatefulHorn

<div class='outer'> 
    @if (Nession != null)
    {
        @for (int i = 0; i < Nession.History.Count; i++)
        {
            Nession.Frame frame = Nession.History[i];
            <div class='frame-container'>
                @if (frame.StateChangePremises.Count > 0)
                {
                    <div class='state-change-premises' title=@frame.TransferRuleDescription>
                        @foreach (Event premise in frame.StateChangePremises)
                        {
                            <EventDisplay Event=@premise/>
                        }
                    </div>
                }
                <div class='state-container'>
                    @for (int j = 0; j < frame.StateSet.Count; j++)
                    {
                        State s = frame.StateSet[j];
                        string stateClass = i > 0 && !Nession.History[i - 1].StateSet[j].Equals(s) ? "state diff" : "state";
                        <div class='@stateClass'>
                            <div class='state-inner'>
                                <span class='state-name'>@s.Name</span>
                                <span class='op'>(</span>
                                <span class='format-values'>@s.Value.ToString()</span>
                                <span class='op'>)</span>
                            </div>
                        </div>
                    }
                </div>
                @if (frame.Rules.Count > 0)
                {
                    <div class='rules-container'>
                        @foreach (StateConsistentRule scr in frame.Rules)
                        {
                            <div class='rules-item'>
                                <RightArrowOperation>
                                        <Left>
                                            @foreach (Event premise in scr.Premises)
                                            {
                                                <EventDisplay Event=@premise/>
                                            }
                                        </Left>
                                        <Right>
                                            <EventDisplay Event=@scr.Result/>
                                        </Right>
                                    </RightArrowOperation>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class='rule-container'>
                        <p class='no-rules-message'>
                            There are no rules to display.
                        </p>
                    </div>
                }
            </div>
        }
    }
    else
    {
        <p class='no-nession-message'>No nession set for display.</p>
    }
</div>

@code {

    [Parameter]
    public Nession? Nession { get; set; }

}
